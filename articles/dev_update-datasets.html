<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Updating EJAM Datasets • EJAM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Updating EJAM Datasets">
<meta name="description" content="Managing large {arrow} datasets used by EJAM app and package">
<meta property="og:description" content="Managing large {arrow} datasets used by EJAM app and package">
<meta property="og:image" content="https://usepa.github.io/EJAM-open/logo.svg">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EJAM</a>

    <small class="nav-text text-warning me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.32.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Overview for EJAM Users</h6></li>
    <li><a class="dropdown-item" href="../articles/0_whatis.html">What is EJAM?</a></li>
    <li><a class="dropdown-item" href="../articles/0_webapp.html">Accessing the Web App</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>For analysts using R</h6></li>
    <li><a class="dropdown-item" href="../articles/1_installing.html">Installing the EJAM R package</a></li>
    <li><a class="dropdown-item" href="../articles/2_quickstart.html">Quick Start Guide</a></li>
    <li><a class="dropdown-item" href="../articles/3_analyzing.html">Using EJAM for Analysis in R</a></li>
    <li><a class="dropdown-item" href="../articles/testdata.html">Examples of Input/Output Files &amp; Data</a></li>
    <li><a class="dropdown-item" href="../articles/distances.html">Comparing Distances (Choosing a Radius)</a></li>
    <li><a class="dropdown-item" href="../articles/naics.html">NAICS (Industries)</a></li>
    <li><a class="dropdown-item" href="../articles/zipcodes.html">Zipcodes</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>For package/app developers</h6></li>
    <li><a class="dropdown-item" href="../articles/dev_deploy-app.html">Deploying the Web App</a></li>
    <li><a class="dropdown-item" href="../articles/dev_run-shinytests.html">Testing EJAM App with shinytest2</a></li>
    <li><a class="dropdown-item" href="../articles/dev_run-unit-tests.html">Testing EJAM Functions with Unit Tests</a></li>
    <li><a class="dropdown-item" href="../articles/dev_update-datasets.html">Updating EJAM Datasets</a></li>
    <li><a class="dropdown-item" href="../articles/dev_update_documentation.html">Updating Documentation</a></li>
    <li><a class="dropdown-item" href="../articles/dev_update-package.html">Updating the Package as a New Release</a></li>
    <li><a class="dropdown-item" href="../articles/dev_future_plans.html">Future Plans and Ideas for EJAM</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Updating EJAM Datasets</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/USEPA/EJAM-open/blob/v2.32.4/vignettes/dev_update-datasets.Rmd" class="external-link"><code>vignettes/dev_update-datasets.Rmd</code></a></small>
      <div class="d-none name"><code>dev_update-datasets.Rmd</code></div>
    </div>

    
    
<p>The EJAM package and Shiny app make use of many data objects,
including numerous datasets stored in the package’s /data/ folder as
well as several large tables stored in a separate repository
specifically created for holding those large tables, which contain
information on Census blockgroups, Census block internal points, Census
block population weights, and EPA FRS facilities.</p>
<div class="section level2">
<h2 id="how-to-update-datasets-in-ejam">How to Update Datasets in EJAM<a class="anchor" aria-label="anchor" href="#how-to-update-datasets-in-ejam"></a>
</h2>
<p>The process begins from within the EJAM code repo, using the various
<code>datacreate_*</code> scripts to create updated arrow datasets.
Notes and scripts are consolidated in the /data-raw/ folder, and the
starting point is the overarching set of scripts and comments in the
file called
<em><code>/data-raw/datacreate_0_UPDATE_ALL_DATASETS.R</code></em>.
Almost all updates of data objects and their documentation are organized
within that file in functions/scripts for the various datasets.
Documentation of datasets via <code>EJAM/R/data_*.R</code> files is
generally handled by those same scripts while creating/updating the
datasets.</p>
<p>That file covers not only the large arrow datasets that are stored in
a separate repository, but also many smaller data objects that are
installed along with the package in the /data/ folder. Updating all the
package’s data objects can be complicated because there are many
different data objects of various types and formats and locations.</p>
<p>The various data objects need to be updated at various frequencies –
some only yearly (ACS data) and others when facility IDs and locations
change (as often as possible, as when <a href="https://www.epa.gov/frs" class="external-link">EPA’s FRS</a> is updated). Some need to
be updated only when the package features/code changes, such as the
important data object called <code>map_headernames</code> (which in turn
is used to update objects such as <code>names_e</code>).</p>
<p>See the draft utility <code>EJAM:::datapack()</code> for a view of
datasets if useful:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">EJAM</span><span class="fu">:::</span><span class="fu"><a href="../reference/datapack.html">datapack</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Get more info with datapack(simple = FALSE)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ignoring sortbysize because simple=TRUE</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">Item</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"names_|^test"</span>, <span class="va">x</span><span class="op">$</span><span class="va">Item</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "NAICS"                              "SIC"                               </span></span>
<span><span class="co">##  [3] "avg.in.us"                          "bg_cenpop2020"                     </span></span>
<span><span class="co">##  [5] "bgpts"                              "blockgroupstats"                   </span></span>
<span><span class="co">##  [7] "censusplaces"                       "custom"                            </span></span>
<span><span class="co">##  [9] "default_points_shown_at_startup"    "ejamdata_version"                  </span></span>
<span><span class="co">## [11] "ejampackages"                       "ejscreenRESTbroker2table_na_filler"</span></span>
<span><span class="co">## [13] "epa_programs"                       "epa_programs_defined"              </span></span>
<span><span class="co">## [15] "formulas_all"                       "formulas_d"                        </span></span>
<span><span class="co">## [17] "frsprogramcodes"                    "high_pctiles_tied_with_min"        </span></span>
<span><span class="co">## [19] "islandareas"                        "lat_alias"                         </span></span>
<span><span class="co">## [21] "lon_alias"                          "mact_table"                        </span></span>
<span><span class="co">## [23] "map_headernames"                    "metadata4pins"                     </span></span>
<span><span class="co">## [25] "meters_per_mile"                    "modelDoaggregate"                  </span></span>
<span><span class="co">## [27] "modelEjamit"                        "naics_counts"                      </span></span>
<span><span class="co">## [29] "naicstable"                         "namez"                             </span></span>
<span><span class="co">## [31] "sictable"                           "stateinfo"                         </span></span>
<span><span class="co">## [33] "stateinfo2"                         "states_shapefile"                  </span></span>
<span><span class="co">## [35] "statestats"                         "usastats"                          </span></span>
<span><span class="co">## [37] "x_anyother"</span></span></code></pre>
<p>Some notable data files, code details, and other objects that may
need to be changed ANNUALLY or more often:</p>
<ul>
<li>
<p><strong><em>Blockgroup Datasets</em></strong>: These include
datasets included with the package <code><a href="../reference/blockgroupstats.html">?blockgroupstats</a></code>, <a href="../reference/usastats.html">usastats</a>,
<code><a href="../reference/statestats.html">?statestats</a></code>, etc.) as well as larger tables stored in a
separate repository and downloaded by the EJAM package
(<code><a href="../reference/bgpts.html">?bgpts</a></code>, <code><a href="../reference/bgej.html">?bgej</a></code>, <code><a href="../reference/bgid2fips.html">?bgid2fips</a></code>,
<code><a href="../reference/bg_cenpop2020.html">?bg_cenpop2020</a></code>, etc.). They are all created or modified
using scripts/functions organized from within
<em><code>/data-raw/datacreate_0_UPDATE_ALL_DATASETS.R</code></em>.</p>
<ul>
<li>NOTE: Prior to 2025, several key datasets used by EJAM were obtained
from EPA’s EJScreen-related FTP site and others directly from relevant
staff. Many of the indicators on the Community Report for the v2.2
(early 2024) EJScreen data were NOT provided in the gdb and csv files on
the FTP site, so they had to be obtained directly from the EJScreen team
as a separate .csv file. The code referred to from
<em><code>/data-raw/datacreate_0_UPDATE_ALL_DATASETS.R</code></em>
assumes the basic datasets from EPA are available, and then converts
them into the datasets actually used by EJAM. However, if those are no
longer available from those sources, the data could mostly be
independently recreated, but this would require a combination of
existing code and significant new work. Some relevant code was in
archived EJScreen repositories, for creating environmental datasets.
Some code is in EJAM functions that can get ACS datasets. Much relevant
code was in an older non-EPA package called ejscreen, which had been
made private as of early 2025 but could be refreshed. That package had
tools such as ejscreen.create() that had been able to reproduce parts of
the blockgroupstats and usastats/statestats datasets.</li>
</ul>
</li>
<li><p><strong><em>Block Datasets</em></strong>: The <em>block</em> (not
block group) tables might be updated less often, but Census fips codes
do change yearly so the <code><a href="../reference/blockwts.html">?blockwts</a></code>,
<code><a href="../reference/blockpoints.html">?blockpoints</a></code>, <code><a href="../reference/quaddata.html">?quaddata</a></code>,
<code><a href="../reference/blockid2fips.html">?blockid2fips</a></code>, and related additional data.tables should be
updated as needed. This is also done from within
<em><code>/data-raw/datacreate_0_UPDATE_ALL_DATASETS.R</code></em> See
package <code>census2020download</code> on github for the function
<code>census2020_get_data()</code> that may be useful.</p></li>
<li><p><strong><em>Facilities Datasets</em></strong>: EPA-regulated
facilities or other types of sites, and their
<em>NAICS/SIC/MACT/program</em> information, may need frequent updates,
ideally, since facilities open, close, relocate, or have their
information corrected or otherwise updated. EPA’s FRS is the source for
much of this information stored in tables EJAM uses, such as these:
<code><a href="../reference/frs.html">?frs</a></code>, <code><a href="../reference/frs_by_programid.html">?frs_by_programid</a></code>,
<code><a href="../reference/frs_by_naics.html">?frs_by_naics</a></code>, <code><a href="../reference/frs_by_sic.html">?frs_by_sic</a></code>, and
<code><a href="../reference/frs_by_mact.html">?frs_by_mact</a></code>, <code><a href="../reference/NAICS.html">?NAICS</a></code>, <code><a href="../reference/SIC.html">?SIC</a></code>,
<code><a href="../reference/naics_counts.html">?naics_counts</a></code>, <code><a href="../reference/naicstable.html">?naicstable</a></code>, <code><a href="../reference/SIC.html">?SIC</a></code>,
<code><a href="../reference/sictable.html">?sictable</a></code>, <code><a href="../reference/mact_table.html">?mact_table</a></code>, and
<code><a href="../reference/epa_programs.html">?epa_programs</a></code>, <code><a href="../reference/frsprogramcodes.html">?frsprogramcodes</a></code>, etc. Again
these are updated from within
<em><code>/data-raw/datacreate_0_UPDATE_ALL_DATASETS.R</code></em></p></li>
<li><p><code><a href="../reference/map_headernames.html">?map_headernames</a></code> and associated .xlsx, etc. are
critical. This needs to updated especially if indicator names change or
are added, for example. <code><a href="../reference/map_headernames.html">?map_headernames</a></code> holds most of the
useful metadata about each variable (each indicator, like %low income) –
e.g., how many digits to use in rounding, units, a long name of
indicator, the type or category of indicator, sort order to use in
reports, method of calculating aggregations of the indicator over
blockgroups, etc. This is modified directly in the spreadsheet
map_headernames, and then functions/scripts read that .xlsx to create
the map_headernames dataset. See
<em><code>/data-raw/datacreate_0_UPDATE_ALL_DATASETS.R</code></em></p></li>
<li><p><a href="testdata.Rmd">Test data (inputs) and examples of
outputs</a> may have to be updated (every time parameters change &amp;
when outputs returned change). Those are generated by scripts/functions
referred to from
<em><code>/data-raw/datacreate_0_UPDATE_ALL_DATASETS.R</code></em></p></li>
<li><p>A default year is used in various functions, such as for the last
year of the 5-year ACS dataset. These defaults like yr or year should be
updated via global searches where relevant.</p></li>
<li><p>metadata about vintage/ version is in attributes of most
datasets. That is updated via scripts/functions used by
<em><code>/data-raw/datacreate_0_UPDATE_ALL_DATASETS.R</code></em> via
for example the helpers <code><a href="../reference/metadata_add.html">metadata_add()</a></code> and
<code><a href="../reference/metadata_check.html">metadata_check()</a></code> and
<code>metadata_mapping.R</code></p></li>
<li><p>Version numbering is recorded in the DESCRIPTION file primarily,
and note use of the <code>ejamdata_version.txt</code> file, and tags on
releases, and the NEWS file.</p></li>
<li><p><a href="dev_update_documentation.html">Updating
documentation</a> - updates may be needed for the README, vignettes, and
possibly examples in some functions in case updates to datasets alter
how the examples would work.</p></li>
</ul>
<p>Again, all of those updates should be done starting from an
understanding of the file called
<code>/data-raw/datacreate_0_UPDATE_ALL_DATASETS.R</code>. That script
includes steps to update metadata and documentation and save new
versions of data in the data folder if appropriate.</p>
<p>The information below focuses on the other type of data objects – the
set of large <a href="https://github.com/apache/arrow/" class="external-link">arrow</a> files that are stored outside the
package code repository.</p>
<div class="section level3">
<h3 id="repository-that-stores-the-large-arrow-files">Repository that stores the large arrow files<a class="anchor" aria-label="anchor" href="#repository-that-stores-the-large-arrow-files"></a>
</h3>
<p>Several large <a href="https://r-datatable.com" class="external-link">data.table</a> files are not installed as
part of the R package in the typical /data/ folder that contains .rda
files lazyloaded by the package. Instead, they are kept in a separate
github repository that we refer to here as the data repository.</p>
<p><em>IMPORTANT:</em> The name of the <em>data</em> repository (as
distinct from the <em>package code</em> repository) must be recorded/
updated in the EJAM package DESCRIPTION file, so that the package will
know where to look for the data files if the datasets were moved to a
new repository, for example. The current (either installed or loaded
source version) of that repository is <a href="https://usepa.github.io/EJAM-open" class="uri">https://usepa.github.io/EJAM-open</a> (which can be checked
via
<code>desc::desc(file = system.file("DESCRIPTION", package = "EJAM"))$get("ejam_data_repo")</code>)</p>
</div>
<div class="section level3">
<h3 id="arrow-package-and-arrow-file-format">arrow package and arrow file format<a class="anchor" aria-label="anchor" href="#arrow-package-and-arrow-file-format"></a>
</h3>
<p>To store the large files needed by the EJAM package, we use the
Apache arrow file format through the <a href="https://github.com/apache/arrow/" class="external-link">arrow</a> R package,
with file extension <code>.arrow</code>. This allows us to work with
larger-than-memory data and store it outside of the EJAM package
itself.</p>
<p>Earlier version of EJAM did not use the actual arrow format, so there
still may be places in the code that simply use the xyz.arrow filename
but not the actual arrow format that is faster, and those would ideally
get updated. For example the object called <code>frs_arrow</code> is the
faster format of what had been called the <code><a href="../reference/frs.html">?frs</a></code> dataset.</p>
<p>The names of these tables should be listed in a file called
<code>R/arrow_ds_names.R</code> and the global variable called
.arrow_ds_names that is used by functions like
<code><a href="../reference/dataload_dynamic.html">dataload_dynamic()</a></code> and
<code><a href="../reference/dataload_from_local.html">dataload_from_local()</a></code>.</p>
<p>As of mid-2025, there were 11 arrow files used by EJAM:</p>
</div>
<div class="section level3">
<h3 id="blockgroup-and-block-level-arrow-files">Blockgroup and block-level arrow files<a class="anchor" aria-label="anchor" href="#blockgroup-and-block-level-arrow-files"></a>
</h3>
<ul>
<li>
<code><a href="../reference/bgid2fips.html">?bgid2fips</a></code>.arrow: crosswalk of EJAM blockgroup IDs
(1-n) with 12-digit blockgroup FIPS codes</li>
<li>
<code><a href="../reference/blockid2fips.html">?blockid2fips</a></code>.arrow: crosswalk of EJAM block IDs (1-n)
with 15-digit block FIPS codes</li>
<li>
<code><a href="../reference/blockpoints.html">?blockpoints</a></code>.arrow: Census block internal points
lat-lon coordinates, EJAM block ID</li>
<li>
<code><a href="../reference/blockwts.html">?blockwts</a></code>.arrow: Census block population weight as
share of blockgroup population, EJAM block and blockgroup ID</li>
<li>
<code><a href="../reference/bgej.html">?bgej</a></code>.arrow: blockgroup-level statistics of EJ
variables</li>
<li>
<code><a href="../reference/quaddata.html">?quaddata</a></code>.arrow: 3D spherical coordinates of Census
block internal points, with EJAM block ID</li>
</ul>
</div>
<div class="section level3">
<h3 id="frsfacility-related-arrow-files">FRS/facility-related arrow files<a class="anchor" aria-label="anchor" href="#frsfacility-related-arrow-files"></a>
</h3>
<ul>
<li>
<code><a href="../reference/frs.html">?frs</a></code>.arrow: data.table of EPA Facility Registry Service
(FRS) regulated sites</li>
<li>
<code><a href="../reference/frs_by_naics.html">?frs_by_naics</a></code>.arrow: data.table of NAICS industry
code(s) for each EPA-regulated site in Facility Registry Service</li>
<li>
<code><a href="../reference/frs_by_sic.html">?frs_by_sic</a></code>.arrow: data.table of SIC industry code(s)
for each EPA-regulated site in Facility Registry Service</li>
<li>
<code>?frs_by_programid.arrow</code>: data.table of Program System
ID code(s) for each EPA-regulated site in the Facility Registry
Service</li>
<li>
<code><a href="../reference/frs_by_mact.html">?frs_by_mact</a></code>.arrow: data.table of <a href="https://en.wikipedia.org/wiki/National_Emissions_Standards_for_Hazardous_Air_Pollutants" class="external-link">MACT
NESHAP</a> codes for sites, indicating the <a href="https://www.epa.gov/stationary-sources-air-pollution/national-emission-standards-hazardous-air-pollutants-neshap-8" class="external-link">subpart(s)
that categorize relevant EPA-regulated sites</a>
</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="developmentsetup">Development/Setup<a class="anchor" aria-label="anchor" href="#developmentsetup"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>The arrow files are stored in a separate, public, Git-LFS-enabled
GitHub repo (henceforth ‘ejamdata’). The owner/reponame must be
recorded/updated in the DESCRIPTION file field called ejam_data_repo –
that info is used by the package.</p></li>
<li><p>Then, and any time the arrow datasets are updated, we update the
ejamdata release version via the <code>.github/push_to_ejam.yaml</code>
workflow in the ejamdata repo, thereby saving the arrow files with the
release, to be downloaded automatically by EJAM</p></li>
<li><p>EJAM’s <code><a href="../reference/download_latest_arrow_data.html">download_latest_arrow_data()</a></code> function does
the following:</p></li>
</ol>
<!-- --><ol style="list-style-type: lower-alpha">
<li>Checks ejamdata repo’s latest release/version.</li>
<li>Checks user’s EJAM package’s ejamdata version, which is stored in
<code>data/ejamdata_version.txt</code>.</li>
<li>If the <code>data/ejamdata_version.txt</code> file doesn’t exist,
e.g. if it’s the first time installing EJAM, it will be created at the
end of the script.</li>
<li>If the versions are different, download the latest arrow from the
latest ejamdata release with <code><a href="https://docs.ropensci.org/piggyback/reference/pb_download.html" class="external-link">piggyback::pb_download()</a></code>. see
how this function works for details:</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/download_latest_arrow_data.html">download_latest_arrow_data</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>We add a call to this function in the onAttach script (via the
<code><a href="../reference/dataload_dynamic.html">dataload_dynamic()</a></code> function) so it runs and ensures the
latest arrow files are downloaded when user loads EJAM.</li>
</ol>
</div>
<div class="section level2">
<h2 id="how-it-works-for-the-user">How it Works for the User<a class="anchor" aria-label="anchor" href="#how-it-works-for-the-user"></a>
</h2>
<ol style="list-style-type: decimal">
<li>User installs EJAM</li>
</ol>
<!-- --><ul>
<li>
<code>devtools::install_github("USEPA/EJAM-open")</code> (or as
adjusted depending on the actual repository owner and name)</li>
</ul>
<!-- --><ol start="2" style="list-style-type: decimal">
<li>User loads EJAM as usual</li>
</ol>
<!-- --><ul>
<li>
<code><a href="https://usepa.github.io/EJAM-open">library(EJAM)</a></code>. This will trigger the new
<code><a href="../reference/download_latest_arrow_data.html">download_latest_arrow_data()</a></code> function.</li>
</ul>
<!-- --><ol start="3" style="list-style-type: decimal">
<li>User runs EJAM as usual</li>
</ol>
<!-- --><ul>
<li>The <code><a href="../reference/dataload_dynamic.html">dataload_dynamic()</a></code> function will work as usual
because the data are now stored in the <code>data</code> directory.</li>
</ul>
</div>
<div class="section level2">
<h2 id="how-new-versions-of-arrow-datasets-are-republished-released">How new versions of arrow datasets are republished/ released<a class="anchor" aria-label="anchor" href="#how-new-versions-of-arrow-datasets-are-republished-released"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>The key arrow files are updated from within the EJAM code
repository, as explained above.</p></li>
<li><p>Those files were then being copied into a clone of the ejamdata
repo before being pushed to the actual ejamdata repo on github (at
USEPA/ejamdata)</p></li>
<li><p>This triggers ejamdata’s <code>push_to_ejam.yaml</code> workflow
that increments the latest release tag reflecting the new version and
creates a new release</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="potential-improvements">Potential Improvements<a class="anchor" aria-label="anchor" href="#potential-improvements"></a>
</h2>
<div class="section level3">
<h3 id="making-code-more-arrow-friendly">Making Code more Arrow-Friendly<a class="anchor" aria-label="anchor" href="#making-code-more-arrow-friendly"></a>
</h3>
<p>Problem: loading the data as tibbles/dataframes takes a long time</p>
<p>Solution: We may be able to modify our code to be more arrow
-friendly. This essentially keeps the analysis code as a sort of query,
and only actually loads the results into memory when requested (e.g.,
via <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">dplyr::collect()</a></code>) This dramatically reduces used
memory, which would speed up processing times and avoid potential
crashes resulting from not enough memory. However, this would require a
decent lift to update the code in all places</p>
<p>Pros: processing efficiency, significantly reduced memory usage</p>
<p>Implementation: This has been mostly implemented by the
<code><a href="../reference/dataload_dynamic.html">dataload_dynamic()</a></code> function, which contains a
<code>return_data_table</code> parameter. If <code>FALSE</code>, the
arrow file is loaded as an .arrow dataset, rather than a
tibble/dataframe.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>2025</p>
</div>

<div class="pkgdown-footer-right">
  <p>EJAM Version 2.32.4</p>
</div>

    </footer>
</div>





  </body>
</html>
