<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate more summary stats across all sites and all people — batch.summarize • EJAM</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate more summary stats across all sites and all people — batch.summarize"><meta name="description" content="Calculate more summary stats across all sites and all people"><meta property="og:description" content="Calculate more summary stats across all sites and all people"><meta property="og:image" content="https://usepa.github.io/EJAM-open/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EJAM</a>

    <small class="nav-text text-warning me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.32.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Overview for EJAM Users</h6></li>
    <li><a class="dropdown-item" href="../articles/0_whatis.html">What is EJAM?</a></li>
    <li><a class="dropdown-item" href="../articles/0_webapp.html">Accessing the Web App</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>For analysts using R</h6></li>
    <li><a class="dropdown-item" href="../articles/1_installing.html">Installing the EJAM R package</a></li>
    <li><a class="dropdown-item" href="../articles/2_quickstart.html">Quick Start Guide</a></li>
    <li><a class="dropdown-item" href="../articles/3_analyzing.html">Using EJAM for Analysis in R</a></li>
    <li><a class="dropdown-item" href="../articles/testdata.html">Examples of Input/Output Files &amp; Data</a></li>
    <li><a class="dropdown-item" href="../articles/distances.html">Comparing Distances (Choosing a Radius)</a></li>
    <li><a class="dropdown-item" href="../articles/naics.html">NAICS (Industries)</a></li>
    <li><a class="dropdown-item" href="../articles/zipcodes.html">Zipcodes</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>For package/app developers</h6></li>
    <li><a class="dropdown-item" href="../articles/dev_deploy-app.html">Deploying the Web App</a></li>
    <li><a class="dropdown-item" href="../articles/dev_run-shinytests.html">Testing EJAM App with shinytest2</a></li>
    <li><a class="dropdown-item" href="../articles/dev_run-unit-tests.html">Testing EJAM Functions with Unit Tests</a></li>
    <li><a class="dropdown-item" href="../articles/dev_update-datasets.html">Updating EJAM Datasets</a></li>
    <li><a class="dropdown-item" href="../articles/dev_update_documentation.html">Updating Documentation</a></li>
    <li><a class="dropdown-item" href="../articles/dev_update-package.html">Updating the Package as a New Release</a></li>
    <li><a class="dropdown-item" href="../articles/dev_future_plans.html">Future Plans and Ideas for EJAM</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Calculate more summary stats across all sites and all people</h1>
      <small class="dont-index">Source: <a href="https://github.com/USEPA/EJAM-open/blob/HEAD/R/batch.summarize.R" class="external-link"><code>R/batch.summarize.R</code></a></small>
      <div class="d-none name"><code>batch.summarize.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculate more summary stats across all sites and all people</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">batch.summarize</span><span class="op">(</span></span>
<span>  <span class="va">ejamitout</span>,</span>
<span>  <span class="va">sitestats</span>,</span>
<span>  <span class="va">popstats</span>,</span>
<span>  <span class="va">overall</span>,</span>
<span>  wtscolname <span class="op">=</span> <span class="st">"pop"</span>,</span>
<span>  probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">90</span><span class="op">)</span>,</span>
<span>  threshnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">sitestats</span>, <span class="va">class</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"character"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  threshgroups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"variables"</span><span class="op">)</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  rowfun.picked <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  colfun.picked <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  testing <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-ejamitout">ejamitout<a class="anchor" aria-label="anchor" href="#arg-ejamitout"></a></dt>
<dd><p>Not typically used. If it is provided,
then parameters sitestats, popstats, and overall are ignored.
A list that is the output of <code><a href="ejamit.html">ejamit()</a></code> – the list of tables including
results_bysite, results_bybg_people, results_overall.
ejamit() actually already does batch.summarize(), but this param might be
useful interactively if you want to redo just the batch.summarize() step
with new params like thresholds or probs.</p></dd>


<dt id="arg-sitestats">sitestats<a class="anchor" aria-label="anchor" href="#arg-sitestats"></a></dt>
<dd><p>A data.frame or data.table like <code><a href="ejamit.html">ejamit()</a></code>$results_bysite,
with one row per site and one column per indicator.
Ignored if ejamitout is provided.</p></dd>


<dt id="arg-popstats">popstats<a class="anchor" aria-label="anchor" href="#arg-popstats"></a></dt>
<dd><p>A data.frame or data.table like <code><a href="ejamit.html">ejamit()</a></code>$results_bysite,
with one row per blockgroup at least partly in/at one or more of the sites,
and one column per indicator. It provides blockgroup indicators, including
total counts even for the blockgroups that are not entirely in/at a site.
This is used to get stats on the distribution of each indicator across all
unique individuals (regardless of how many sites a resident is at).
Ignored if ejamitout is provided.</p></dd>


<dt id="arg-overall">overall<a class="anchor" aria-label="anchor" href="#arg-overall"></a></dt>
<dd><p>A data.frame or data.table like <code><a href="ejamit.html">ejamit()</a></code>$results_bysite,
with one column per indicator, and just one data row that has the overall
average, sum, or other summary stat for the indicator across all sites.
Ignored if ejamitout is provided.</p></dd>


<dt id="arg-wtscolname">wtscolname<a class="anchor" aria-label="anchor" href="#arg-wtscolname"></a></dt>
<dd><p>Name of the column that contains the relevant weights to be used (e.g., "pop")</p></dd>


<dt id="arg-probs">probs<a class="anchor" aria-label="anchor" href="#arg-probs"></a></dt>
<dd><p>Vector of numeric values, fractions, to use as probabilities used in finding quantiles.</p></dd>


<dt id="arg-thresholds">thresholds<a class="anchor" aria-label="anchor" href="#arg-thresholds"></a></dt>
<dd><p>list of vectors each with 1+ thresholds (cutpoints) used to count find sites
where 1+ of given set of indicators are at/above the threshold &amp; how many of the indicators are.
If an element of the list is a single number, that is used for the whole group (all the threshnames in that nth list element).
Otherwise/in general, each vector is recycled over the threshnames in corresponding list element,
so each threshname can have its own threshold like some field-specific benchmark, or they can all use the same threshold like 50.</p></dd>


<dt id="arg-threshnames">threshnames<a class="anchor" aria-label="anchor" href="#arg-threshnames"></a></dt>
<dd><p>list of vectors of character colnames defining fields in x that get compared to threshold, or to thresholds</p></dd>


<dt id="arg-threshgroups">threshgroups<a class="anchor" aria-label="anchor" href="#arg-threshgroups"></a></dt>
<dd><p>of 1+ character strings naming the elements of threshnames list, such as "EJ US pctiles"</p></dd>


<dt id="arg-na-rm">na.rm<a class="anchor" aria-label="anchor" href="#arg-na-rm"></a></dt>
<dd><p>Logical TRUE by default, specifying if na.rm should be used for sum(), mean(), and other functions.</p></dd>


<dt id="arg-rowfun-picked">rowfun.picked<a class="anchor" aria-label="anchor" href="#arg-rowfun-picked"></a></dt>
<dd><p>logical vector specifying which of the pre-defined functions (like at/above threshold) are needed and will be applied</p></dd>


<dt id="arg-colfun-picked">colfun.picked<a class="anchor" aria-label="anchor" href="#arg-colfun-picked"></a></dt>
<dd><p>logical vector specifying which of the pre-defined functions (like colSums) are needed and will be applied</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>optional logical, set to TRUE to stop printing results to console in RStudio.</p></dd>


<dt id="arg-testing">testing<a class="anchor" aria-label="anchor" href="#arg-testing"></a></dt>
<dd><p>optional, default is FALSE. prints some debugging info if TRUE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>output is a list with two named elements, rows and cols, where each is a matrix of summary stats.</p>
<p>cols: Each element in a summary col summarizes 1 row (site) across all the RELEVANT cols of batch data
(e.g., all US Summary Index percentiles). This type of info is also saved in a tab of the output of <code><a href="ejam2excel.html">ejam2excel()</a></code></p>
<p>rows: Each element in a summary row summarizes 1 column (field) across all the rows of batch data.
A subset of this is $keyindicators</p>
<p>keystats: Key subset of the summary stats (for all indicators), for convenience. See <code><a href="ejam2table_tall.html">ejam2table_tall()</a></code> to view this.</p>
<p>keyindicators: Key subset of the indicators from $row results
(for stats characterizing the distribution of each across people or sites,
like avg, mean, and percentiles), for convenience</p>
<p>flagged_areas: table of percentages of people or sites, here (people at analyzed sites) and nationwide,
who reside in blockgroups that overlap at all with key types of areas like
<a href="https://www.epa.gov/criteria-air-pollutants/process-determine-whether-areas-meet-naaqs-designations-process" class="external-link">nonattainment for air standards</a>,
and who have at least one school / hospital / church in their blockgroup,
and with no broadband, and with no health insurance.
This can be viewed using <code><a href="ejam2areafeatures.html">ejam2areafeatures()</a></code></p>
<p>In the flagged_areas table, summary stats mean the following:</p><ul><li><p>The "flag" or "yesno" indicators here are population weighted sums, so they show
how many people from the analysis live in blockgroups
that overlap with the given special type of area, such as
non-attainment areas under the Clean Air Act.</p></li>
<li><p>The "number" indicators are counts for each site in the
<code>ejamit()$results_overall</code> table, but here are summarized as
what percent of residents overall in the analysis have
AT LEAST ONE OR MORE of that type of site in
the blockgroup they live in.</p></li>
<li><p>The "pctno" or % indicators are summarized as what % of the
residents analyzed lack the critical service.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This is the function that takes the <code><a href="doaggregate.html">doaggregate()</a></code> results and
calculates even more summary statistics, notably to characterize
the distribution of indicator values across people and across sites,
as percentile of analyzed people and percentile of analyzed sites, etc.</p>
<p>It can be expanded to provide other summary stats by adding those other formulas to this code.</p>
<p>Note it can provide population-weighted summary stats only for the indicators found in popstats,
which is fewer than those in sitestats, since doaggregate() or ejamit() did not
provide various extra indicators in the very large results_bybg_people table.
The parameter sitestats but not popstats has the ratios and pctiles (and US/State averages) of indicators,
plus "bgid" "bgwt" and "valid" "invalid_msg"
So this function cannot show, e.g., the median analyzed person's
ratio of local score to US average,
and cannot say the Demog. Index US percentile was at least X% of people
nationwide among the top 10% of people analyzed.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="ejam2areafeatures.html">ejam2areafeatures()</a></code> <code><a href="ejamit.html">ejamit()</a></code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>2025</p>
</div>

<div class="pkgdown-footer-right">
  <p>EJAM Version 2.32.3</p>
</div>

    </footer></div>





  </body></html>

